<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Demo 7: Pruning &mdash; Kolmogorov Arnold Network  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Demo 8: Checkpoint" href="API_8_checkpoint.html" />
    <link rel="prev" title="Demo 6: Training Hyperparamters" href="API_6_training_hyperparameter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Kolmogorov Arnold Network
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Hello, KAN!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../demos.html">API Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="API_1_indexing.html">Demo 1: Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_2_plotting.html">Demo 2: Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_3_grid.html">Demo 3: Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_4_extract_activations.html">Demo 4: Extracting activation functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_5_initialization_hyperparameter.html">Demo 5: Initialization Hyperparamters</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_6_training_hyperparameter.html">Demo 6: Training Hyperparamters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Demo 7: Pruning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#automatic-pruning">Automatic pruning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manual-pruning">Manual pruning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="API_8_checkpoint.html">Demo 8: Checkpoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_9_video.html">Demo 9: Videos</a></li>
<li class="toctree-l2"><a class="reference internal" href="API_10_device.html">Demo 10: Device</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kolmogorov Arnold Network</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../demos.html">API Demos</a></li>
      <li class="breadcrumb-item active">Demo 7: Pruning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/API_demo/API_7_pruning.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="demo-7-pruning">
<h1>Demo 7: Pruning<a class="headerlink" href="#demo-7-pruning" title="Link to this heading"></a></h1>
<p>We usually use pruning to make neural networks sparser hence more
efficient and more interpretable. KANs provide two ways of pruning:
automatic pruning, and manual pruning.</p>
<section id="automatic-pruning">
<h2>Automatic pruning<a class="headerlink" href="#automatic-pruning" title="Link to this heading"></a></h2>
<p>For each node, we consider it active if both of its max incoming l1 and
outgoing l1 are above some threshold (see paper for details). Only
active neurons will be kept, while inactive neurons are pruned away.
Note that there is no automatic edge pruning, just to be safe (there are
cases where important edges have small l1 norm). However, one can
manually prune away nodes and edges.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from kan import *
# create a KAN: 2D inputs, 1D output, and 5 hidden neurons. cubic spline (k=3), 5 grid intervals (grid=5).
model = KAN(width=[2,5,1], grid=5, k=3, seed=0)

# create dataset f(x,y) = exp(sin(pi*x)+y^2)
f = lambda x: torch.exp(torch.sin(torch.pi*x[:,[0]]) + x[:,[1]]**2)
dataset = create_dataset(f, n_var=2)
dataset[&#39;train_input&#39;].shape, dataset[&#39;train_label&#39;].shape

# train the model
model.train(dataset, opt=&quot;LBFGS&quot;, steps=20, lamb=0.01, lamb_entropy=10.);
model = model.prune()
model(dataset[&#39;train_input&#39;])
model.plot()
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>train loss: 1.54e-01 | test loss: 1.30e-01 | reg: 2.02e+01 : 100%|██| 20/20 [00:11&lt;00:00,  1.68it/s]
</pre></div>
</div>
<img alt="../_images/API_7_pruning_2_1.png" src="../_images/API_7_pruning_2_1.png" />
<p>Let’s try to use different threshold, by default, threshold = 1e-2</p>
<p>threshold = 1e-4 leaves more hidden nodes.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from kan import *
# create a KAN: 2D inputs, 1D output, and 5 hidden neurons. cubic spline (k=3), 5 grid intervals (grid=5).
model = KAN(width=[2,5,1], grid=5, k=3, seed=0)

# create dataset f(x,y) = exp(sin(pi*x)+y^2)
f = lambda x: torch.exp(torch.sin(torch.pi*x[:,[0]]) + x[:,[1]]**2)
dataset = create_dataset(f, n_var=2)
dataset[&#39;train_input&#39;].shape, dataset[&#39;train_label&#39;].shape

# train the model
model.train(dataset, opt=&quot;LBFGS&quot;, steps=20, lamb=0.01, lamb_entropy=10.);
model = model.prune(threshold=1e-4)
model(dataset[&#39;train_input&#39;])
model.plot()
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>train loss: 1.54e-01 | test loss: 1.30e-01 | reg: 2.02e+01 : 100%|██| 20/20 [00:11&lt;00:00,  1.70it/s]
</pre></div>
</div>
<img alt="../_images/API_7_pruning_5_1.png" src="../_images/API_7_pruning_5_1.png" />
</section>
<section id="manual-pruning">
<h2>Manual pruning<a class="headerlink" href="#manual-pruning" title="Link to this heading"></a></h2>
<p>We can manually prune away nodes</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.remove_node(1,0)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.plot()
</pre></div>
</div>
<img alt="../_images/API_7_pruning_9_0.png" src="../_images/API_7_pruning_9_0.png" />
<p>We can also manually remove edges</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.remove_edge(0,0,1)
model.remove_edge(0,0,3)
model.remove_edge(0,1,1)
model.remove_edge(0,1,3)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model.plot()
</pre></div>
</div>
<img alt="../_images/API_7_pruning_12_0.png" src="../_images/API_7_pruning_12_0.png" />
<p>Use prune() if you don’t want to see these inactive nodes in the hiddenl
layer</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = model.prune(mode=&#39;manual&#39;, active_neurons_id=[[0,1],[2],[0]]);
model(dataset[&#39;train_input&#39;])
model.plot()
</pre></div>
</div>
<img alt="../_images/API_7_pruning_14_0.png" src="../_images/API_7_pruning_14_0.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="API_6_training_hyperparameter.html" class="btn btn-neutral float-left" title="Demo 6: Training Hyperparamters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="API_8_checkpoint.html" class="btn btn-neutral float-right" title="Demo 8: Checkpoint" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ziming Liu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>